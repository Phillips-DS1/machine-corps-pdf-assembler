name: Grok Code Review               # This is just the name you will see

on:                                  # When should this run?
  pull_request:                      # Every time a Pull Request is opened or updated

jobs:
  review:
    runs-on: ubuntu-latest           # GitHub will use a fresh Linux computer

    steps:
    - name: Checkout code
      uses: actions/checkout@v4      # Downloads your code so Grok can see it

    - name: Install Python tools
      run: pip install xai-sdk      # Installs the official xAI library

    - name: Ask Grok to review the changes
      env:
        GROK_API_KEY: ${{ secrets.GROK_API_KEY }}   # Gets your secret key safely
      run: |
        python - <<EOF
        import os
        from xai_sdk import Client

        client = Client(api_key=os.getenv("GROK_API_KEY"))
        diff = "$(git diff HEAD~1)"   # Gets the code changes

        response = client.chat.completions.create(
            model="grok-4",
            messages=[{
                "role": "user",
                "content": f"Please review these code changes and suggest improvements:\n\n{diff}"
            }]
        )
        print("### Grok Code Review")
        print(response.choices[0].message.content)
        EOF
